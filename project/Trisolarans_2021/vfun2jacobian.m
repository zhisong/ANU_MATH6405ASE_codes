function Jacobian = vfun2jacobian(u)

x = u(1);
y = u(2);

w = 1/sqrt(sqrt(3));

x1 = 1;
x2 = -1/2;
x3 = -1/2;

y1 = 0;
y2 = sqrt(3)/2;
y3 = -sqrt(3)/2;

r1 = sqrt((x-x1)^2+(y-y1)^2);
r2 = sqrt((x-x2)^2+(y-y2)^2);
r3 = sqrt((x-x3)^2+(y-y3)^2);

Jacobian = zeros([4,4]);

Jacobian(1,1) = 0;
Jacobian(1,2) = w;
Jacobian(1,3) = 1;
Jacobian(1,4) = 0;

Jacobian(2,1) = -w;
Jacobian(2,2) = 0;
Jacobian(2,3) = 0;
Jacobian(2,4) = 1;

Jacobian(3,1) = (3*(-1 + x)^2)/((-1 + x)^2 + y^2)^(5/2) - 1/((-1 + x)^2 + y^2)^(3/2) +(3*(1/2 + x)^2)/((1/2 + x)^2 + (-(sqrt(3)/2) + y)^2)^(5/2) - 1/((1/2 + x)^2 + (-(sqrt(3)/2) + y)^2)^(3/...
     2) + (3*(1/2 + x)^2)/((1/2 + x)^2 + (sqrt(3)/2 + y)^2)^(5/2) - 1/((1/2 + x)^2 + (sqrt(3)/2 + y)^2)^(3/2);

Jacobian(3,2) = (3*(-1 + x)*y)/((-1 + x)^2 + y^2)^(5/2) + (3*(1/2 + x)*(-(sqrt(3)/2) + y))/((1/2 + x)^2 + (-(sqrt(3)/2) + y)^2)^(5/2) + (3*(1/2 + x)*(sqrt(3)/2 + y))/((1/2 + x)^2 + (sqrt(3)/2 + y)^2)^(5/2);     
Jacobian(3,3) = 0;
Jacobian(3,4) = w;

Jacobian(4,1) = (3*(-1 + x)*y)/((-1 + x)^2 + y^2)^(5/2) + (3*(1/2 + x)*(-(sqrt(3)/2) + y))/((1/2 + x)^2 + (-(sqrt(3)/2) + y)^2)^(5/2) + (3*(1/2 + x)*(sqrt(3)/2 + y))/((1/2 + x)^2 + (sqrt(3)/2 + y)^2)^(5/2);
   
Jacobian(4,2) = (3*y^2)/((-1 + x)^2 + y^2)^(5/2) - 1/((-1 + x)^2 + y^2)^(3/2) + (3*(-(sqrt(3)/2) + y)^2)/((1/2 + x)^2 + (-(sqrt(3)/2) + y)^2)^(5/2) - 1/((1/2 + x)^2 + (-(sqrt(3)/2) + y)^2)^(3/2) + (3*(sqrt(3)/2 + y)^2)/((1/2 + x)^2 + (sqrt(3)/2 + y)^2)^(5/2) - ...
 1/((1/2 + x)^2 + (sqrt(3)/2 + y)^2)^(3/2);
Jacobian(4,3) = -w;
Jacobian(4,4) = 0;

end

